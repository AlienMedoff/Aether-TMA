<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Aether-TMA | Agent Vision</title>
    <style>
        body { margin: 0; background: #0a0a0a; color: #00ff41; font-family: 'Courier New', monospace; display: flex; height: 100vh; overflow: hidden; }
        #viewport { flex: 2; border-right: 1px solid #333; position: relative; background: #000; display: flex; align-items: center; justify-content: center; }
        #stream { max-width: 100%; max-height: 100%; border: 2px solid #222; border-radius: 10px; }
        #sidebar { flex: 1; padding: 20px; display: flex; flex-direction: column; background: #0f0f0f; }
        .log-entry { margin-bottom: 10px; border-bottom: 1px solid #222; padding-bottom: 5px; font-size: 0.9em; }
        .thought { color: #00bfff; font-style: italic; }
        .action { color: #ff00ff; font-weight: bold; }
        #status-bar { padding: 10px; background: #1a1a1a; border-radius: 5px; margin-bottom: 20px; }
        h3 { border-bottom: 1px solid #00ff41; padding-bottom: 5px; }
    </style>
</head>
<body>
    <div id="viewport">
        <img id="stream" src="" alt="Agent Viewport Tracking...">
    </div>
    <div id="sidebar">
        <div id="status-bar">SYSTEM: ONLINE | SESSION: <span id="sess-id">ACTIVE</span></div>
        <h3>AGENT LOGS (REASONING)</h3>
        <div id="logs" style="overflow-y: auto; flex-grow: 1;"></div>
    </div>

    <script>
        // Подключаемся к WebSocket. Сессия 'test' для примера.
        const ws = new WebSocket(`ws://${window.location.host}/ws/monitor/test_drive_001`);
        const logContainer = document.getElementById('logs');
        const streamImg = document.getElementById('stream');

        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            
            // Обновляем картинку (база64 из сервера)
            if (data.image) {
                streamImg.src = `data:image/jpeg;base64,${data.image}`;
            }

            // Если прилетел лог мыслей
            if (data.thought) {
                const entry = document.createElement('div');
                entry.className = 'log-entry';
                entry.innerHTML = `<span class="thought">[THOUGHT]: ${data.thought}</span>`;
                logContainer.prepend(entry);
            }
        };
    </script>
</body>
</html>
